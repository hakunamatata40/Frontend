{% extends "base.html" %}
{% load static %}
{% load users_extras %}

{% block title %}Sign Up{% endblock %}

{% block content %}
<div class="max-w-md mx-auto bg-white p-4 sm:p-8 rounded-lg shadow-md mt-4 sm:mt-10">
    <!-- Étape 1 - Formulaire principal -->
    <div id="step1">
        <h2 class="text-2xl sm:text-3xl font-bold text-center text-blue-600 mb-4 sm:mb-6">Create an Account</h2>
        <form method="post" enctype="multipart/form-data" id="signupForm">
            {% csrf_token %}

            <!-- Afficher tous les champs SAUF les intérêts -->
            {% for field in form %}
                {% if field.name != 'interests' %}
                <div class="mb-3 sm:mb-4">
                    <label for="{{ field.id_for_label }}" class="block text-gray-700 text-xs sm:text-sm font-bold mb-1 sm:mb-2">
                        {{ field.label }}
                        {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}
                    </label>

                    {{ field|add_class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-xs sm:text-sm" }}

                    {% if field.help_text %}
                        <p class="text-gray-500 text-xs italic mt-1">{{ field.help_text }}</p>
                    {% endif %}

                    {% for error in field.errors %}
                        <p class="text-red-500 text-xs italic mt-1">{{ error }}</p>
                    {% endfor %}
                </div>
                {% endif %}
            {% endfor %}

            {% if form.non_field_errors %}
                <div class="mb-3 sm:mb-4 p-2 sm:p-3 bg-red-100 border border-red-400 text-red-700 rounded relative text-xs sm:text-sm" role="alert">
                    <strong class="font-bold">Error!</strong>
                    <span class="block sm:inline">
                        {% for error in form.non_field_errors %}
                            {{ error }}
                        {% endfor %}
                    </span>
                </div>
            {% endif %}

            <button type="button" id="nextBtn" class="w-full bg-blue-600 text-white p-2 sm:p-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300 text-sm sm:text-base">Suivant</button>
        </form>
    </div>

    <!-- Étape 2 - Sélection des intérêts (cachée initialement) -->
    <div id="step2" class="hidden">
        <h2 class="text-2xl sm:text-3xl font-bold text-center text-blue-600 mb-4 sm:mb-6">Vos centres d'intérêt</h2>
        <p class="text-center text-gray-600 mb-4 sm:mb-6 text-sm sm:text-base">Sélectionnez ce qui vous intéresse</p>

        <div class="flex flex-wrap gap-2 sm:gap-3 mb-4 sm:mb-6">
            {% with form.interests as interests_field %}
                {% for choice in interests_field %}
                    <label for="{{ choice.id_for_label }}" class="interest-card">
                        <input type="checkbox"
                               name="{{ choice.name }}"
                               value="{{ choice.value }}"
                               id="{{ choice.id_for_label }}"
                               {% if choice.data.selected %}checked{% endif %}
                               class="hidden">
                        <div class="px-4 py-2 sm:px-6 sm:py-3 border-2 border-gray-200 rounded-full flex items-center justify-center cursor-pointer transition-all duration-300 hover:border-blue-400 hover:bg-blue-50 hover:shadow-md text-xs sm:text-sm">
                            <span class="font-medium">{{ choice.choice_label }}</span>
                        </div>
                    </label>
                {% endfor %}
            {% endwith %}
        </div>

        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4 mt-6 sm:mt-8">
            <button type="button" id="backBtn" class="flex-1 bg-gray-200 text-gray-800 p-2 sm:p-3 rounded-lg font-semibold hover:bg-gray-300 transition duration-300 text-sm sm:text-base">Retour</button>
            <button type="submit" form="signupForm" class="flex-1 bg-blue-600 text-white p-2 sm:p-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300 text-sm sm:text-base">S'inscrire</button>
        </div>
    </div>
</div>

<style>
    .interest-card input:checked + div {
        background-color: #3b82f6;
        color: white;
        border-color: #3b82f6;
        transform: scale(1.05);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    @media (max-width: 640px) {
        .interest-card {
            flex: 1 0 calc(50% - 0.5rem);
            max-width: calc(50% - 0.5rem);
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const nextBtn = document.getElementById('nextBtn');
        const backBtn = document.getElementById('backBtn');
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');

        // Animation pour passer à l'étape 2
        nextBtn.addEventListener('click', function() {
            // Vérifier la validité du formulaire avant de continuer
            const form = document.getElementById('signupForm');
            let isValid = true;

            // Valider tous les champs visibles (étape 1)
            const inputs = step1.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (!input.reportValidity()) {
                    isValid = false;
                }
            });

            if (isValid) {
                // Animation de transition
                step1.style.opacity = '1';
                let opacity = 1;
                const fadeOut = setInterval(() => {
                    opacity -= 0.05;
                    step1.style.opacity = opacity;
                    if (opacity <= 0) {
                        clearInterval(fadeOut);
                        step1.classList.add('hidden');
                        step2.classList.remove('hidden');
                        step2.style.opacity = '0';

                        // Animation d'apparition
                        let fadeInOpacity = 0;
                        const fadeIn = setInterval(() => {
                            fadeInOpacity += 0.05;
                            step2.style.opacity = fadeInOpacity;
                            if (fadeInOpacity >= 1) {
                                clearInterval(fadeIn);
                            }
                        }, 20);
                    }
                }, 20);
            }
        });

        // Retour à l'étape 1
        backBtn.addEventListener('click', function() {
            // Animation similaire mais inverse
            step2.style.opacity = '1';
            let opacity = 1;
            const fadeOut = setInterval(() => {
                opacity -= 0.05;
                step2.style.opacity = opacity;
                if (opacity <= 0) {
                    clearInterval(fadeOut);
                    step2.classList.add('hidden');
                    step1.classList.remove('hidden');
                    step1.style.opacity = '0';

                    let fadeInOpacity = 0;
                    const fadeIn = setInterval(() => {
                        fadeInOpacity += 0.05;
                        step1.style.opacity = fadeInOpacity;
                        if (fadeInOpacity >= 1) {
                            clearInterval(fadeIn);
                        }
                    }, 20);
                }
            }, 20);
        });
    });
</script>
{% endblock %}